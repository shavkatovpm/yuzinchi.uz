---
// Loading Screen Component
// Shows 0-100% counter, then reveals "ishonch" text with blur effect
// Uses Space Grotesk font (same as hero section)
---

<div id="loading-screen" class="loading-screen">
  <div class="loading-content">
    <div class="counter-wrapper">
      <span id="counter" class="counter">0</span>
      <span class="percent">%</span>
    </div>
    <div id="ishonch-text" class="ishonch-text">ishonch</div>
  </div>
</div>

<style>
  .loading-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #262626;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    transition: opacity 0.5s ease, visibility 0.5s ease;
  }

  .loading-screen.fade-out {
    opacity: 0;
    visibility: hidden;
  }

  .loading-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0;
  }

  .counter-wrapper {
    display: flex;
    align-items: baseline;
    font-family: 'Space Grotesk', system-ui, sans-serif;
  }

  .counter {
    font-size: clamp(7.5rem, 30vw, 21rem);
    font-weight: 700;
    color: #628141;
    line-height: 1;
    letter-spacing: -0.02em;
  }

  .percent {
    font-size: clamp(3.75rem, 12vw, 9rem);
    font-weight: 600;
    color: #628141;
    margin-left: 0.05em;
  }

  .ishonch-text {
    font-family: 'Space Grotesk', system-ui, sans-serif;
    font-size: clamp(5rem, 20vw, 14rem);
    font-weight: 700;
    color: #628141;
    letter-spacing: -0.02em;
    text-transform: lowercase;
    opacity: 0;
    filter: blur(20px);
    transform: translateY(20px);
    transition: opacity 0.8s ease, filter 0.8s ease, transform 0.8s ease;
    margin-top: -0.5rem;
  }

  .ishonch-text.visible {
    opacity: 1;
    filter: blur(0);
    transform: translateY(0);
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const counter = document.getElementById('counter');
    const ishonchText = document.getElementById('ishonch-text');
    const loadingScreen = document.getElementById('loading-screen');

    if (!counter || !ishonchText || !loadingScreen) return;

    // Faqat birinchi kirishda ko'rsatish
    const hasVisited = sessionStorage.getItem('yuzinchi_visited');

    if (hasVisited) {
      // Allaqachon kirgan - loadingni yashirish
      loadingScreen.style.display = 'none';
      return;
    }

    let count = 0;
    const targetCount = 100;
    const duration = 1200; // 1.2 seconds for counting - fast and dramatic

    // Easing function for smooth acceleration then slow at end
    const easeOutQuart = (t: number): number => {
      return 1 - Math.pow(1 - t, 4);
    };

    const startTime = performance.now();

    const animate = (currentTime: number) => {
      const elapsed = currentTime - startTime;
      const progress = Math.min(elapsed / duration, 1);

      // Apply easing
      const easedProgress = easeOutQuart(progress);
      count = Math.floor(easedProgress * targetCount);

      counter.textContent = count.toString();

      if (progress < 1) {
        requestAnimationFrame(animate);
      } else {
        // Ensure we hit exactly 100
        counter.textContent = '100';

        // Show "ishonch" text after reaching 100%
        setTimeout(() => {
          ishonchText.classList.add('visible');

          // Fade out loading screen after showing "ishonch"
          setTimeout(() => {
            loadingScreen.classList.add('fade-out');

            // Tashrif buyurganini belgilash
            sessionStorage.setItem('yuzinchi_visited', 'true');

            // Remove from DOM after animation
            setTimeout(() => {
              loadingScreen.style.display = 'none';
            }, 500);
          }, 1200); // Show "ishonch" for 1.2 seconds
        }, 150); // Small delay before showing "ishonch"
      }
    };

    requestAnimationFrame(animate);
  });
</script>
