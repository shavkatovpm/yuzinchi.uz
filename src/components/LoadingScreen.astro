---
// Loading Screen Component
// Shows 0-100% counter, then reveals "ishonch" text
---

<div id="loading-screen" class="loading-screen">
  <div class="loading-content">
    <div class="counter-wrapper">
      <span id="counter" class="counter">0</span>
      <span class="percent">%</span>
    </div>
    <div id="ishonch-text" class="ishonch-text">ishonch</div>
  </div>
</div>

<style>
  .loading-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #262626;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    transition: opacity 0.5s ease, visibility 0.5s ease;
  }

  .loading-screen.fade-out {
    opacity: 0;
    visibility: hidden;
  }

  .loading-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0;
  }

  .counter-wrapper {
    display: flex;
    align-items: baseline;
    font-family: 'Space Grotesk', system-ui, sans-serif;
  }

  .counter {
    font-size: clamp(4rem, 15vw, 10rem);
    font-weight: 700;
    color: #ececec;
    line-height: 1;
    letter-spacing: -0.02em;
  }

  .percent {
    font-size: clamp(2rem, 6vw, 4rem);
    font-weight: 600;
    color: #628141;
    margin-left: 0.1em;
  }

  .ishonch-text {
    font-family: 'Space Grotesk', system-ui, sans-serif;
    font-size: clamp(1.5rem, 5vw, 3rem);
    font-weight: 600;
    color: #628141;
    letter-spacing: 0.3em;
    text-transform: uppercase;
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.6s ease, transform 0.6s ease;
    margin-top: 0.5rem;
  }

  .ishonch-text.visible {
    opacity: 1;
    transform: translateY(0);
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const counter = document.getElementById('counter');
    const ishonchText = document.getElementById('ishonch-text');
    const loadingScreen = document.getElementById('loading-screen');

    if (!counter || !ishonchText || !loadingScreen) return;

    // Check if already visited in this session
    const hasVisited = sessionStorage.getItem('hasVisitedYuzinchi');

    if (hasVisited) {
      // Skip animation for returning visitors in same session
      loadingScreen.classList.add('fade-out');
      setTimeout(() => {
        loadingScreen.style.display = 'none';
      }, 100);
      return;
    }

    let count = 0;
    const targetCount = 100;
    const duration = 1500; // 1.5 seconds for counting
    const frameRate = 60;
    const totalFrames = (duration / 1000) * frameRate;
    const increment = targetCount / totalFrames;

    // Easing function for smooth acceleration
    const easeOutQuart = (t: number): number => {
      return 1 - Math.pow(1 - t, 4);
    };

    const startTime = performance.now();

    const animate = (currentTime: number) => {
      const elapsed = currentTime - startTime;
      const progress = Math.min(elapsed / duration, 1);

      // Apply easing
      const easedProgress = easeOutQuart(progress);
      count = Math.floor(easedProgress * targetCount);

      counter.textContent = count.toString();

      if (progress < 1) {
        requestAnimationFrame(animate);
      } else {
        // Ensure we hit exactly 100
        counter.textContent = '100';

        // Show "ishonch" text after reaching 100%
        setTimeout(() => {
          ishonchText.classList.add('visible');

          // Fade out loading screen after showing "ishonch"
          setTimeout(() => {
            loadingScreen.classList.add('fade-out');

            // Mark as visited
            sessionStorage.setItem('hasVisitedYuzinchi', 'true');

            // Remove from DOM after animation
            setTimeout(() => {
              loadingScreen.style.display = 'none';
            }, 500);
          }, 800); // Show "ishonch" for 0.8 seconds
        }, 200); // Small delay before showing "ishonch"
      }
    };

    requestAnimationFrame(animate);
  });
</script>
