---
import { getCollection } from 'astro:content';
import BaseLayout from '../../../layouts/BaseLayout.astro';
import CTA from '../../../components/CTA.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog', ({ id }) => id.startsWith('uz/'));
  return posts.map((post) => ({
    params: { slug: post.slug.replace('uz/', '') },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();

const formattedDate = post.data.pubDate.toLocaleDateString('uz-UZ', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});
---

<BaseLayout
  title={`${post.data.title} - Yuzinchi Blog`}
  description={post.data.description}
  type="article"
  publishedTime={post.data.pubDate.toISOString()}
>
  <article class="section-padding">
    <div class="container-custom">
      <div class="mx-auto max-w-3xl">
        <!-- Header -->
        <header class="text-center">
          <time class="text-sm text-light/50">
            {formattedDate}
          </time>
          <h1 class="mt-4 text-3xl font-bold text-light md:text-4xl lg:text-5xl">
            {post.data.title}
          </h1>
          <p class="mt-4 text-lg text-light/60">
            {post.data.description}
          </p>
          {post.data.tags && post.data.tags.length > 0 && (
            <div class="mt-6 flex flex-wrap justify-center gap-2">
              {post.data.tags.map((tag: string) => (
                <span class="rounded-full bg-accent/10 px-4 py-1.5 text-sm font-medium text-accent">
                  {tag}
                </span>
              ))}
            </div>
          )}
        </header>

        <!-- Hero Image -->
        {post.data.heroImage && (
          <div class="mt-8 overflow-hidden rounded-2xl">
            <img
              src={post.data.heroImage}
              alt={post.data.title}
              class="w-full"
            />
          </div>
        )}

        <!-- Content -->
        <div class="prose prose-lg prose-invert mx-auto mt-12 max-w-none prose-headings:text-light prose-a:text-accent prose-strong:text-light">
          <Content />
        </div>

        <!-- Author -->
        <div class="mt-12 flex items-center justify-center gap-4 rounded-2xl border border-light/5 bg-light/[0.02] p-6">
          <div class="flex h-12 w-12 items-center justify-center rounded-full bg-accent text-light">
            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
          </div>
          <div>
            <p class="font-semibold text-light">{post.data.author}</p>
            <p class="text-sm text-light/60">Yuzinchi Marketing</p>
          </div>
        </div>

        <!-- Back to Blog -->
        <div class="mt-8 text-center">
          <a
            href="/uz/blog"
            class="inline-flex items-center gap-2 text-accent hover:underline"
          >
            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
            Barcha maqolalar
          </a>
        </div>
      </div>
    </div>
  </article>

  <CTA />
</BaseLayout>
